/*
Copyright © 2025-2026 Leo Zhang

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
---
MIT License

Copyright (c) 2020 Kris Zyp

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CBOR={})}(this,(function(e){"use strict";let t,r,n;try{t=new TextDecoder}catch(e){}let i=0;const s={};let o,a,l,f,u,c,d,h=11281e4,y=1681e4,p={},g=0,w=0,b=[],m=[],A={useRecords:!1,mapsAsObjects:!0},v=!1,O=2;try{new Function("")}catch(e){O=1/0}class k{constructor(e){if(e&&(!e.keyMap&&!e._keyMap||e.useRecords||(e.useRecords=!1,e.mapsAsObjects=!0),!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[t,r]of Object.entries(e.keyMap))this.mapKey.set(r,t)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let t=new Map;for(let[r,n]of Object.entries(e))t.set(this._keyMap.hasOwnProperty(r)?this._keyMap[r]:r,n);return t}decodeKeys(e){if(!this._keyMap||"Map"!=e.constructor.name)return e;if(!this._mapKey){this._mapKey=new Map;for(let[e,t]of Object.entries(this._keyMap))this._mapKey.set(t,e)}let t={};return e.forEach(((e,r)=>t[M(this._mapKey.has(r)?this._mapKey.get(r):r)]=e)),t}mapDecode(e,t){let r=this.decode(e);return this._keyMap&&"Array"===r.constructor.name?r.map((e=>this.decodeKeys(e))):r}decode(e,t){if(r)return H((()=>(Y(),this?this.decode(e,t):k.prototype.decode.call(A,e,t))));n=t>-1?t:e.length,i=0,w=0,a=null,l=null,r=e;try{c=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(r=null,e instanceof Uint8Array)throw t;throw new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof k){if(p=this,u=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return o=this.structures,E();(!o||o.length>0)&&(o=[])}else p=A,(!o||o.length>0)&&(o=[]),u=null;return E()}decodeMultiple(e,t){let r,n=0;try{let s=e.length;v=!0;let o=this?this.decode(e,s):Z.decode(e,s);if(!t){for(r=[o];i<s;)n=i,r.push(E());return r}if(!1===t(o))return;for(;i<s;)if(n=i,!1===t(E()))return}catch(e){throw e.lastPosition=n,e.values=r,e}finally{v=!1,Y()}}}function E(){try{let e=I();if(l){if(i>=l.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}i=l.postBundlePosition,l=null}if(i==n)o=null,r=null,f&&(f=null);else{if(i>n){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}if(!v)throw new Error("Data read, but end of buffer not reached")}return e}catch(e){throw Y(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function I(){let e=r[i++],t=e>>5;if(e&=31,e>23)switch(e){case 24:e=r[i++];break;case 25:if(7==t)return function(){let e=r[i++],t=r[i++],n=(127&e)>>2;if(31===n)return t||3&e?NaN:128&e?-1/0:1/0;if(0===n){let r=((3&e)<<8|t)/(1<<24);return 128&e?-r:r}return _[3]=128&e|56+(n>>1),_[2]=(7&e)<<5|t>>3,_[1]=t<<5,_[0]=0,P[0]}();e=c.getUint16(i),i+=2;break;case 26:if(7==t){let e=c.getFloat32(i);if(p.useFloat32>2){let t=q[(127&r[i])<<1|r[i+1]>>7];return i+=4,(t*e+(e>0?.5:-.5)>>0)/t}return i+=4,e}e=c.getUint32(i),i+=4;break;case 27:if(7==t){let e=c.getFloat64(i);return i+=8,e}if(t>1){if(c.getUint32(i)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");e=c.getUint32(i+4)}else p.int64AsNumber?(e=4294967296*c.getUint32(i),e+=c.getUint32(i+4)):e=c.getBigUint64(i);i+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let e,r=[],n=0;for(;(e=I())!=s;){if(n>=h)throw new Error(`Array length exceeds ${h}`);r[n++]=e}return 4==t?r:3==t?r.join(""):Buffer.concat(r);case 5:let i;if(p.mapsAsObjects){let e={},t=0;if(p.keyMap)for(;(i=I())!=s;){if(t++>=y)throw new Error(`Property count exceeds ${y}`);e[M(p.decodeKey(i))]=I()}else for(;(i=I())!=s;){if(t++>=y)throw new Error(`Property count exceeds ${y}`);e[M(i)]=I()}return e}{d&&(p.mapsAsObjects=!0,d=!1);let e=new Map;if(p.keyMap){let t=0;for(;(i=I())!=s;){if(t++>=y)throw new Error(`Map size exceeds ${y}`);e.set(p.decodeKey(i),I())}}else{let t=0;for(;(i=I())!=s;){if(t++>=y)throw new Error(`Map size exceeds ${y}`);e.set(i,I())}}return e}case 7:return s;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+e)}switch(t){case 0:return e;case 1:return~e;case 2:return f=e,p.copyBuffers?Uint8Array.prototype.slice.call(r,i,i+=f):r.subarray(i,i+=f);case 3:if(w>=i)return a.slice(i-g,(i+=e)-g);if(0==w&&n<140&&e<32){let t=e<16?V(e):function(e){let t=i,n=new Array(e);for(let s=0;s<e;s++){const e=r[i++];if((128&e)>0)return void(i=t);n[s]=e}return B.apply(String,n)}(e);if(null!=t)return t}return x(e);case 4:if(e>=h)throw new Error(`Array length exceeds ${h}`);let t=new Array(e);for(let r=0;r<e;r++)t[r]=I();return t;case 5:if(e>=y)throw new Error(`Map size exceeds ${h}`);if(p.mapsAsObjects){let t={};if(p.keyMap)for(let r=0;r<e;r++)t[M(p.decodeKey(I()))]=I();else for(let r=0;r<e;r++)t[M(I())]=I();return t}{d&&(p.mapsAsObjects=!0,d=!1);let t=new Map;if(p.keyMap)for(let r=0;r<e;r++)t.set(p.decodeKey(I()),I());else for(let r=0;r<e;r++)t.set(I(),I());return t}case 6:if(e>=57337){let t=o[8191&e];if(t)return t.read||(t.read=S(t)),t.read();if(e<65536){if(57343==e){let e=$(),t=I(),r=I();F(t,r);let n={};if(p.keyMap)for(let t=2;t<e;t++){n[M(p.decodeKey(r[t-2]))]=I()}else for(let t=2;t<e;t++){n[M(r[t-2])]=I()}return n}if(57342==e){let e=$(),t=I();for(let r=2;r<e;r++)F(t++,I());return I()}if(57337==e)return function(){let e=$(),t=i+I();for(let t=2;t<e;t++){let e=$();i+=e}let r=i;return i=t,l=[j($()),j($())],l.position0=0,l.position1=0,l.postBundlePosition=i,i=r,I()}();if(p.getShared&&(J(),t=o[8191&e],t))return t.read||(t.read=S(t)),t.read()}}let s=b[e];if(s)return s.handlesRead?s(I):s(I());{let t=I();for(let r=0;r<m.length;r++){let n=m[r](e,t);if(void 0!==n)return n}return new R(t,e)}case 7:switch(e){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:let t=(u||K())[e];if(void 0!==t)return t;throw new Error("Unknown token "+e)}default:if(isNaN(e)){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}throw new Error("Unknown CBOR token "+e)}var f}const U=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function S(e){if(!e)throw new Error("Structure is required in record definition");return e.slowReads=0,function(){let e=r[i++];if(e&=31,e>23)switch(e){case 24:e=r[i++];break;case 25:e=c.getUint16(i),i+=2;break;case 26:e=c.getUint32(i),i+=4;break;default:throw new Error("Expected array header, but got "+r[i-1])}let t=this.compiledReader;for(;t;){if(t.propertyCount===e)return t(I);t=t.next}if(this.slowReads++>=O){let r=this.length==e?this:this.slice(0,e);return t=p.keyMap?new Function("r","return {"+r.map((e=>p.decodeKey(e))).map((e=>U.test(e)?M(e)+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}"):new Function("r","return {"+r.map((e=>U.test(e)?M(e)+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}"),this.compiledReader&&(t.next=this.compiledReader),t.propertyCount=e,this.compiledReader=t,t(I)}let n={};if(p.keyMap)for(let t=0;t<e;t++)n[M(p.decodeKey(this[t]))]=I();else for(let t=0;t<e;t++)n[M(this[t])]=I();return n}}function M(e){if("string"==typeof e)return"__proto__"===e?"__proto_":e;if("number"==typeof e||"boolean"==typeof e||"bigint"==typeof e)return e.toString();if(null==e)return e+"";throw new Error("Invalid property name type "+typeof e)}let x=j;function j(e){let n;if(e<16&&(n=V(e)))return n;if(e>64&&t)return t.decode(r.subarray(i,i+=e));const s=i+e,o=[];for(n="";i<s;){const e=r[i++];if(0==(128&e))o.push(e);else if(192==(224&e)){const t=63&r[i++];o.push((31&e)<<6|t)}else if(224==(240&e)){const t=63&r[i++],n=63&r[i++];o.push((31&e)<<12|t<<6|n)}else if(240==(248&e)){let t=(7&e)<<18|(63&r[i++])<<12|(63&r[i++])<<6|63&r[i++];t>65535&&(t-=65536,o.push(t>>>10&1023|55296),t=56320|1023&t),o.push(t)}else o.push(e);o.length>=4096&&(n+=B.apply(String,o),o.length=0)}return o.length>0&&(n+=B.apply(String,o)),n}let B=String.fromCharCode;function V(e){if(e<4){if(e<2){if(0===e)return"";{let e=r[i++];return(128&e)>1?void(i-=1):B(e)}}{let t=r[i++],n=r[i++];if((128&t)>0||(128&n)>0)return void(i-=2);if(e<3)return B(t,n);let s=r[i++];return(128&s)>0?void(i-=3):B(t,n,s)}}{let t=r[i++],n=r[i++],s=r[i++],o=r[i++];if((128&t)>0||(128&n)>0||(128&s)>0||(128&o)>0)return void(i-=4);if(e<6){if(4===e)return B(t,n,s,o);{let e=r[i++];return(128&e)>0?void(i-=5):B(t,n,s,o,e)}}if(e<8){let a=r[i++],l=r[i++];if((128&a)>0||(128&l)>0)return void(i-=6);if(e<7)return B(t,n,s,o,a,l);let f=r[i++];return(128&f)>0?void(i-=7):B(t,n,s,o,a,l,f)}{let a=r[i++],l=r[i++],f=r[i++],u=r[i++];if((128&a)>0||(128&l)>0||(128&f)>0||(128&u)>0)return void(i-=8);if(e<10){if(8===e)return B(t,n,s,o,a,l,f,u);{let e=r[i++];return(128&e)>0?void(i-=9):B(t,n,s,o,a,l,f,u,e)}}if(e<12){let c=r[i++],d=r[i++];if((128&c)>0||(128&d)>0)return void(i-=10);if(e<11)return B(t,n,s,o,a,l,f,u,c,d);let h=r[i++];return(128&h)>0?void(i-=11):B(t,n,s,o,a,l,f,u,c,d,h)}{let c=r[i++],d=r[i++],h=r[i++],y=r[i++];if((128&c)>0||(128&d)>0||(128&h)>0||(128&y)>0)return void(i-=12);if(e<14){if(12===e)return B(t,n,s,o,a,l,f,u,c,d,h,y);{let e=r[i++];return(128&e)>0?void(i-=13):B(t,n,s,o,a,l,f,u,c,d,h,y,e)}}{let p=r[i++],g=r[i++];if((128&p)>0||(128&g)>0)return void(i-=14);if(e<15)return B(t,n,s,o,a,l,f,u,c,d,h,y,p,g);let w=r[i++];return(128&w)>0?void(i-=15):B(t,n,s,o,a,l,f,u,c,d,h,y,p,g,w)}}}}}let P=new Float32Array(1),_=new Uint8Array(P.buffer,0,4);new Array(4096);class R{constructor(e,t){this.value=e,this.tag=t}}b[0]=e=>new Date(e),b[1]=e=>new Date(Math.round(1e3*e)),b[2]=e=>{let t=BigInt(0);for(let r=0,n=e.byteLength;r<n;r++)t=BigInt(e[r])+(t<<BigInt(8));return t},b[3]=e=>BigInt(-1)-b[2](e),b[4]=e=>+(e[1]+"e"+e[0]),b[5]=e=>e[1]*Math.exp(e[0]*Math.log(2));const F=(e,t)=>{let r=o[e-=57344];r&&r.isShared&&((o.restoreStructures||(o.restoreStructures=[]))[e]=r),o[e]=t,t.read=S(t)};b[105]=e=>{let t=e.length,r=e[1];F(e[0],r);let n={};for(let i=2;i<t;i++){n[M(r[i-2])]=e[i]}return n},b[14]=e=>l?l[0].slice(l.position0,l.position0+=e):new R(e,14),b[15]=e=>l?l[1].slice(l.position1,l.position1+=e):new R(e,15);let T={Error:Error,RegExp:RegExp};b[27]=e=>(T[e[0]]||Error)(e[1],e[2]);const D=e=>{if(132!=r[i++]){let e=new Error("Packed values structure must be followed by a 4 element array");throw r.length<i&&(e.incomplete=!0),e}let t=e();if(!t||!t.length){let e=new Error("Packed values structure must be followed by a 4 element array");throw e.incomplete=!0,e}return u=u?t.concat(u.slice(t.length)):t,u.prefixes=e(),u.suffixes=e(),e()};function N(e,t){return"string"==typeof e?e+t:e instanceof Array?e.concat(t):Object.assign({},e,t)}function K(){if(!u){if(!p.getShared)throw new Error("No packed values available");J()}return u}D.handlesRead=!0,b[51]=D,b[6]=e=>{if(!u){if(!p.getShared)return new R(e,6);J()}if("number"==typeof e)return u[16+(e>=0?2*e:-2*e-1)];let t=new Error("No support for non-integer packed references yet");throw void 0===e&&(t.incomplete=!0),t},b[28]=e=>{f||(f=new Map,f.id=0);let t,n=f.id++,s=i;t=r[i]>>5==4?[]:{};let o={target:t};f.set(n,o);let a=e();return o.used?(Object.getPrototypeOf(t)!==Object.getPrototypeOf(a)&&(i=s,t=a,f.set(n,{target:t}),a=e()),Object.assign(t,a)):(o.target=a,a)},b[28].handlesRead=!0,b[29]=e=>{let t=f.get(e);return t.used=!0,t.target},b[258]=e=>new Set(e),(b[259]=e=>(p.mapsAsObjects&&(p.mapsAsObjects=!1,d=!0),e())).handlesRead=!0;m.push(((e,t)=>e>=225&&e<=255?N(K().prefixes[e-224],t):e>=28704&&e<=32767?N(K().prefixes[e-28672],t):e>=1879052288&&e<=2147483647?N(K().prefixes[e-1879048192],t):e>=216&&e<=223?N(t,K().suffixes[e-216]):e>=27647&&e<=28671?N(t,K().suffixes[e-27639]):e>=1811940352&&e<=1879048191?N(t,K().suffixes[e-1811939328]):1399353956==e?{packedValues:u,structures:o.slice(0),version:t}:55799==e?t:void 0));const C=1==new Uint8Array(new Uint16Array([1]).buffer)[0],z=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],L=[64,68,69,70,71,72,77,78,79,85,86];for(let e=0;e<z.length;e++)W(z[e],L[e]);function W(e,t){let r,n="get"+e.name.slice(0,-5);"function"==typeof e?r=e.BYTES_PER_ELEMENT:e=null;for(let i=0;i<2;i++){if(!i&&1==r)continue;let s=2==r?1:4==r?2:8==r?3:0;b[i?t:t-4]=1==r||i==C?n=>{if(!e)throw new Error("Could not find typed array for code "+t);return p.copyBuffers||1!==r&&(2!==r||1&n.byteOffset)&&(4!==r||3&n.byteOffset)&&(8!==r||7&n.byteOffset)?new e(Uint8Array.prototype.slice.call(n,0).buffer):new e(n.buffer,n.byteOffset,n.byteLength>>s)}:r=>{if(!e)throw new Error("Could not find typed array for code "+t);let o=new DataView(r.buffer,r.byteOffset,r.byteLength),a=r.length>>s,l=new e(a),f=o[n];for(let e=0;e<a;e++)l[e]=f.call(o,e<<s,i);return l}}}function $(){let e=31&r[i++];if(e>23)switch(e){case 24:e=r[i++];break;case 25:e=c.getUint16(i),i+=2;break;case 26:e=c.getUint32(i),i+=4}return e}function J(){if(p.getShared){let e=H((()=>(r=null,p.getShared())))||{},t=e.structures||[];p.sharedVersion=e.version,u=p.sharedValues=e.packedValues,!0===o?p.structures=o=t:o.splice.apply(o,[0,t.length].concat(t))}}function H(e){let t=n,s=i,u=g,d=w,h=a,y=f,b=l,m=new Uint8Array(r.slice(0,n)),A=o,O=p,k=v,E=e();return n=t,i=s,g=u,w=d,a=h,f=y,l=b,r=m,v=k,o=A,p=O,c=new DataView(r.buffer,r.byteOffset,r.byteLength),E}function Y(){r=null,f=null,o=null}const q=new Array(147);for(let e=0;e<256;e++)q[e]=+("1e"+Math.floor(45.15-.30103*e));let Z=new k({useRecords:!1});const G=Z.decode,Q=Z.decodeMultiple,X={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let ee,te,re;try{ee=new TextEncoder}catch(e){}const ne="object"==typeof globalThis&&globalThis.Buffer,ie=void 0!==ne,se=ie?ne.allocUnsafeSlow:Uint8Array,oe=ie?ne:Uint8Array,ae=ie?4294967296:2144337920;let le,fe,ue,ce,de=0,he=null;const ye=/[\u0080-\uFFFF]/,pe=Symbol("record-id");class ge extends k{constructor(e){let t,r,n,i,s;super(e),this.offset=0,e=e||{};let o=oe.prototype.utf8Write?function(e,t,r){return fe.utf8Write(e,t,r)}:!(!ee||!ee.encodeInto)&&function(e,t){return ee.encodeInto(e,fe.subarray(t)).written},a=this,l=e.structures||e.saveStructures,f=e.maxSharedStructures;if(null==f&&(f=l?128:0),f>8190)throw new Error("Maximum maxSharedStructure is 8190");let u=e.sequential;u&&(f=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let c,d,h,y=e.sharedValues;if(y){h=Object.create(null);for(let e=0,t=y.length;e<t;e++)h[y[e]]=e}let p=[],g=0,w=0;this.mapEncode=function(e,t){if(this._keyMap&&!this._mapped&&"Array"===e.constructor.name)e=e.map((e=>this.encodeKeys(e)));return this.encode(e,t)},this.encode=function(o,l){if(fe||(fe=new se(8192),ue=new DataView(fe.buffer,0,8192),de=0),ce=fe.length-10,ce-de<2048?(fe=new se(fe.length),ue=new DataView(fe.buffer,0,fe.length),ce=fe.length-10,de=0):l===Re&&(de=de+7&2147483640),t=de,a.useSelfDescribedHeader&&(ue.setUint32(de,3654940416),de+=3),s=a.structuredClone?new Map:null,a.bundleStrings&&"string"!=typeof o?(he=[],he.size=1/0):he=null,r=a.structures,r){if(r.uninitialized){let e=a.getShared()||{};a.structures=r=e.structures||[],a.sharedVersion=e.version;let t=a.sharedValues=e.packedValues;if(t){h={};for(let e=0,r=t.length;e<r;e++)h[t[e]]=e}}let e=r.length;if(e>f&&!u&&(e=f),!r.transitions){r.transitions=Object.create(null);for(let t=0;t<e;t++){let e=r[t];if(!e)continue;let n,i=r.transitions;for(let r=0,s=e.length;r<s;r++){void 0===i[pe]&&(i[pe]=t);let s=e[r];n=i[s],n||(n=i[s]=Object.create(null)),i=n}i[pe]=1048576|t}}u||(r.nextId=e)}if(n&&(n=!1),i=r||[],d=h,e.pack){let t=new Map;if(t.values=[],t.encoder=a,t.maxValues=e.maxPrivatePackedValues||(h?16:1/0),t.objectMap=h||!1,t.samplingPackedValues=c,Oe(o,t),t.values.length>0){fe[de++]=216,fe[de++]=51,me(4);let e=t.values;b(e),me(0),me(0),d=Object.create(h||null);for(let t=0,r=e.length;t<r;t++)d[e[t]]=t}}le=l&Te;try{if(le)return;if(b(o),he&&Ue(t,b),a.offset=de,s&&s.idsToInsert){de+=2*s.idsToInsert.length,de>ce&&A(de),a.offset=de;let e=function(e,t){let r,n=2*t.length,i=e.length-n;t.sort(((e,t)=>e.offset>t.offset?1:-1));for(let r=0;r<t.length;r++){let n=t[r];n.id=r;for(let t of n.references)e[t++]=r>>8,e[t]=255&r}for(;r=t.pop();){let t=r.offset;e.copyWithin(t+n,t,i),n-=2;let s=t+n;e[s++]=216,e[s++]=28,i=t}return e}(fe.subarray(t,de),s.idsToInsert);return s=null,e}return l&Re?(fe.start=t,fe.end=de,fe):fe.subarray(t,de)}finally{if(r)if(w<10&&w++,r.length>f&&(r.length=f),g>1e4)r.transitions=null,w=0,g=0,p.length>0&&(p=[]);else if(p.length>0&&!u){for(let e=0,t=p.length;e<t;e++)p[e][pe]=void 0;p=[]}if(n&&a.saveShared){a.structures.length>f&&(a.structures=a.structures.slice(0,f));let e=fe.subarray(t,de);return!1===a.updateSharedData()?a.encode(o):e}l&Fe&&(de=t)}},this.findCommonStringsToPack=()=>(c=new Map,h||(h=Object.create(null)),e=>{let t=e&&e.threshold||4,r=this.pack?e.maxPrivatePackedValues||16:0;y||(y=this.sharedValues=[]);for(let[e,i]of c)i.count>t&&(h[e]=r++,y.push(e),n=!0);for(;this.saveShared&&!1===this.updateSharedData(););c=null});const b=r=>{de>ce&&(fe=A(de));var n,i=typeof r;if("string"===i){if(d){let t=d[r];if(t>=0)return void(t<16?fe[de++]=t+224:(fe[de++]=198,b(1&t?15-t>>1:t-16>>1)));if(c&&!e.pack){let e=c.get(r);e?e.count++:c.set(r,{count:1})}}let i,s=r.length;if(he&&s>=4&&s<1024){if((he.size+=s)>61440){let e,r=(he[0]?3*he[0].length+he[1].length:0)+10;de+r>ce&&(fe=A(de+r)),fe[de++]=217,fe[de++]=223,fe[de++]=249,fe[de++]=he.position?132:130,fe[de++]=26,e=de-t,de+=4,he.position&&Ue(t,b),he=["",""],he.size=0,he.position=e}let e=ye.test(r);return he[e?0:1]+=r,fe[de++]=e?206:207,void b(s)}i=s<32?1:s<256?2:s<65536?3:5;let a=3*s;if(de+a>ce&&(fe=A(de+a)),s<64||!o){let e,t,o,a=de+i;for(e=0;e<s;e++)t=r.charCodeAt(e),t<128?fe[a++]=t:t<2048?(fe[a++]=t>>6|192,fe[a++]=63&t|128):55296==(64512&t)&&56320==(64512&(o=r.charCodeAt(e+1)))?(t=65536+((1023&t)<<10)+(1023&o),e++,fe[a++]=t>>18|240,fe[a++]=t>>12&63|128,fe[a++]=t>>6&63|128,fe[a++]=63&t|128):(fe[a++]=t>>12|224,fe[a++]=t>>6&63|128,fe[a++]=63&t|128);n=a-de-i}else n=o(r,de+i,a);n<24?fe[de++]=96|n:n<256?(i<2&&fe.copyWithin(de+2,de+1,de+1+n),fe[de++]=120,fe[de++]=n):n<65536?(i<3&&fe.copyWithin(de+3,de+2,de+2+n),fe[de++]=121,fe[de++]=n>>8,fe[de++]=255&n):(i<5&&fe.copyWithin(de+5,de+3,de+3+n),fe[de++]=122,ue.setUint32(de,n),de+=4),de+=n}else if("number"===i)if(this.alwaysUseFloat||r>>>0!==r)if(this.alwaysUseFloat||r>>0!==r){let e;if((e=this.useFloat32)>0&&r<4294967296&&r>=-2147483648){let t;if(fe[de++]=250,ue.setFloat32(de,r),e<4||(t=r*q[(127&fe[de])<<1|fe[de+1]>>7])>>0===t)return void(de+=4);de--}fe[de++]=251,ue.setFloat64(de,r),de+=8}else r>=-24?fe[de++]=31-r:r>=-256?(fe[de++]=56,fe[de++]=~r):r>=-65536?(fe[de++]=57,ue.setUint16(de,~r),de+=2):(fe[de++]=58,ue.setUint32(de,~r),de+=4);else r<24?fe[de++]=r:r<256?(fe[de++]=24,fe[de++]=r):r<65536?(fe[de++]=25,fe[de++]=r>>8,fe[de++]=255&r):(fe[de++]=26,ue.setUint32(de,r),de+=4);else if("object"===i)if(r){if(s){let e=s.get(r);if(e){if(fe[de++]=216,fe[de++]=29,fe[de++]=25,!e.references){let t=s.idsToInsert||(s.idsToInsert=[]);e.references=[],t.push(e)}return e.references.push(de-t),void(de+=2)}s.set(r,{offset:de-t})}let e=r.constructor;if(e===Object)m(r);else if(e===Array){(n=r.length)<24?fe[de++]=128|n:me(n);for(let e=0;e<n;e++)b(r[e])}else if(e===Map)if((this.mapsAsObjects?!1!==this.useTag259ForMaps:this.useTag259ForMaps)&&(fe[de++]=217,fe[de++]=1,fe[de++]=3),(n=r.size)<24?fe[de++]=160|n:n<256?(fe[de++]=184,fe[de++]=n):n<65536?(fe[de++]=185,fe[de++]=n>>8,fe[de++]=255&n):(fe[de++]=186,ue.setUint32(de,n),de+=4),a.keyMap)for(let[e,t]of r)b(a.encodeKey(e)),b(t);else for(let[e,t]of r)b(e),b(t);else{for(let e=0,t=te.length;e<t;e++){if(r instanceof re[e]){let t=te[e],n=t.tag;return null==n&&(n=t.getTag&&t.getTag.call(this,r)),n<24?fe[de++]=192|n:n<256?(fe[de++]=216,fe[de++]=n):n<65536?(fe[de++]=217,fe[de++]=n>>8,fe[de++]=255&n):n>-1&&(fe[de++]=218,ue.setUint32(de,n),de+=4),void t.encode.call(this,r,b,A)}}if(r[Symbol.iterator]){if(le){let e=new Error("Iterable should be serialized as iterator");throw e.iteratorNotHandled=!0,e}fe[de++]=159;for(let e of r)b(e);return void(fe[de++]=255)}if(r[Symbol.asyncIterator]||ve(r)){let e=new Error("Iterable/blob should be serialized as iterator");throw e.iteratorNotHandled=!0,e}if(this.useToJSON&&r.toJSON){const e=r.toJSON();if(e!==r)return b(e)}m(r)}}else fe[de++]=246;else if("boolean"===i)fe[de++]=r?245:244;else if("bigint"===i){if(r<BigInt(1)<<BigInt(64)&&r>=0)fe[de++]=27,ue.setBigUint64(de,r);else if(r>-(BigInt(1)<<BigInt(64))&&r<0)fe[de++]=59,ue.setBigUint64(de,-r-BigInt(1));else{if(!this.largeBigIntToFloat){r>=BigInt(0)?fe[de++]=194:(fe[de++]=195,r=BigInt(-1)-r);let e=[];for(;r;)e.push(Number(r&BigInt(255))),r>>=BigInt(8);return void Ie(new Uint8Array(e.reverse()),A)}fe[de++]=251,ue.setFloat64(de,Number(r))}de+=8}else{if("undefined"!==i)throw new Error("Unknown type: "+i);fe[de++]=247}},m=!1===this.useRecords?this.variableMapSize?e=>{let t=Object.keys(e),r=Object.values(e),n=t.length;if(n<24?fe[de++]=160|n:n<256?(fe[de++]=184,fe[de++]=n):n<65536?(fe[de++]=185,fe[de++]=n>>8,fe[de++]=255&n):(fe[de++]=186,ue.setUint32(de,n),de+=4),a.keyMap)for(let e=0;e<n;e++)b(a.encodeKey(t[e])),b(r[e]);else for(let e=0;e<n;e++)b(t[e]),b(r[e])}:e=>{fe[de++]=185;let r=de-t;de+=2;let n=0;if(a.keyMap)for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(b(a.encodeKey(t)),b(e[t]),n++);else for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(b(t),b(e[t]),n++);fe[r+++t]=n>>8,fe[r+t]=255&n}:(e,t)=>{let r,s,o,a=i.transitions||(i.transitions=Object.create(null)),l=0,u=0;if(this.keyMap){o=Object.keys(e).map((e=>this.encodeKey(e))),u=o.length;for(let e=0;e<u;e++){let t=o[e];r=a[t],r||(r=a[t]=Object.create(null),l++),a=r}}else for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(r=a[t],r||(1048576&a[pe]&&(s=65535&a[pe]),r=a[t]=Object.create(null),l++),a=r,u++);let c=a[pe];if(void 0!==c)c&=65535,fe[de++]=217,fe[de++]=c>>8|224,fe[de++]=255&c;else{if(o||(o=a.__keys__||(a.__keys__=Object.keys(e))),void 0===s?(c=i.nextId++,c||(c=0,i.nextId=1),c>=256&&(i.nextId=(c=f)+1)):c=s,i[c]=o,!(c<f)){if(a[pe]=c,ue.setUint32(de,3655335680),de+=3,l&&(g+=w*l),p.length>=256-f&&(p.shift()[pe]=void 0),p.push(a),me(u+2),b(57344+c),b(o),t)return;for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&b(e[t]);return}fe[de++]=217,fe[de++]=c>>8|224,fe[de++]=255&c,a=i.transitions;for(let e=0;e<u;e++)(void 0===a[pe]||1048576&a[pe])&&(a[pe]=c),a=a[o[e]];a[pe]=1048576|c,n=!0}if(u<24?fe[de++]=128|u:me(u),!t)for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&b(e[t])},A=e=>{let r;if(e>16777216){if(e-t>ae)throw new Error("Encoded buffer would be larger than maximum buffer size");r=Math.min(ae,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else r=1+(Math.max(e-t<<2,fe.length-1)>>12)<<12;let n=new se(r);return ue=new DataView(n.buffer,0,r),fe.copy?fe.copy(n,0,t,e):n.set(fe.slice(t,e)),de-=t,t=0,ce=n.length-10,fe=n};let v=100,O=1e3;function*k(e,r,n){let i=e.constructor;if(i===Object){let t=!1!==a.useRecords;t?m(e,!0):we(Object.keys(e).length,160);for(let n in e){let i=e[n];t||b(n),i&&"object"==typeof i?r[n]?yield*k(i,r[n]):yield*E(i,r,n):b(i)}}else if(i===Array){let n=e.length;me(n);for(let i=0;i<n;i++){let n=e[i];n&&("object"==typeof n||de-t>v)?r.element?yield*k(n,r.element):yield*E(n,r,"element"):b(n)}}else if(e[Symbol.iterator]&&!e.buffer){fe[de++]=159;for(let n of e)n&&("object"==typeof n||de-t>v)?r.element?yield*k(n,r.element):yield*E(n,r,"element"):b(n);fe[de++]=255}else ve(e)?(we(e.size,64),yield fe.subarray(t,de),yield e,I()):e[Symbol.asyncIterator]?(fe[de++]=159,yield fe.subarray(t,de),yield e,I(),fe[de++]=255):b(e);n&&de>t?yield fe.subarray(t,de):de-t>v&&(yield fe.subarray(t,de),I())}function*E(e,r,n){let i=de-t;try{b(e),de-t>v&&(yield fe.subarray(t,de),I())}catch(s){if(!s.iteratorNotHandled)throw s;r[n]={},de=t+i,yield*k.call(this,e,r[n])}}function I(){v=O,a.encode(null,Te)}function U(e,t,r){return v=t&&t.chunkThreshold?O=t.chunkThreshold:100,e&&"object"==typeof e?(a.encode(null,Te),r(e,a.iterateProperties||(a.iterateProperties={}),!0)):[a.encode(e)]}async function*S(e,t){for(let r of k(e,t,!0)){let e=r.constructor;if(e===oe||e===Uint8Array)yield r;else if(ve(r)){let e,t=r.stream().getReader();for(;!(e=await t.read()).done;)yield e.value}else if(r[Symbol.asyncIterator])for await(let e of r)I(),e?yield*S(e,t.async||(t.async={})):yield a.encode(e);else yield r}}this.encodeAsIterable=function(e,t){return U(e,t,k)},this.encodeAsAsyncIterable=function(e,t){return U(e,t,S)}}useBuffer(e){fe=e,ue=new DataView(fe.buffer,fe.byteOffset,fe.byteLength),de=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let t=this.structures.slice(0),r=new be(t,this.sharedValues,this.sharedVersion),n=this.saveShared(r,(t=>(t&&t.version||0)==e));return!1===n?(r=this.getShared()||{},this.structures=r.structures||[],this.sharedValues=r.packedValues,this.sharedVersion=r.version,this.structures.nextId=this.structures.length):t.forEach(((e,t)=>this.structures[t]=e)),n}}function we(e,t){e<24?fe[de++]=t|e:e<256?(fe[de++]=24|t,fe[de++]=e):e<65536?(fe[de++]=25|t,fe[de++]=e>>8,fe[de++]=255&e):(fe[de++]=26|t,ue.setUint32(de,e),de+=4)}class be{constructor(e,t,r){this.structures=e,this.packedValues=t,this.version=r}}function me(e){e<24?fe[de++]=128|e:e<256?(fe[de++]=152,fe[de++]=e):e<65536?(fe[de++]=153,fe[de++]=e>>8,fe[de++]=255&e):(fe[de++]=154,ue.setUint32(de,e),de+=4)}const Ae="undefined"==typeof Blob?function(){}:Blob;function ve(e){if(e instanceof Ae)return!0;let t=e[Symbol.toStringTag];return"Blob"===t||"File"===t}function Oe(e,t){switch(typeof e){case"string":if(e.length>3){if(t.objectMap[e]>-1||t.values.length>=t.maxValues)return;let r=t.get(e);if(r)2==++r.count&&t.values.push(e);else if(t.set(e,{count:1}),t.samplingPackedValues){let r=t.samplingPackedValues.get(e);r?r.count++:t.samplingPackedValues.set(e,{count:1})}}break;case"object":if(e)if(e instanceof Array)for(let r=0,n=e.length;r<n;r++)Oe(e[r],t);else{let n=!t.encoder.useRecords;for(var r in e)e.hasOwnProperty(r)&&(n&&Oe(r,t),Oe(e[r],t))}break;case"function":console.log(e)}}const ke=1==new Uint8Array(new Uint16Array([1]).buffer)[0];function Ee(e,t){return!ke&&t>1&&(e-=4),{tag:e,encode:function(e,t){let r=e.byteLength,n=e.byteOffset||0,i=e.buffer||e;t(ie?ne.from(i,n,r):new Uint8Array(i,n,r))}}}function Ie(e,t){let r=e.byteLength;r<24?fe[de++]=64+r:r<256?(fe[de++]=88,fe[de++]=r):r<65536?(fe[de++]=89,fe[de++]=r>>8,fe[de++]=255&r):(fe[de++]=90,ue.setUint32(de,r),de+=4),de+r>=fe.length&&t(de+r),fe.set(e.buffer?e:new Uint8Array(e),de),de+=r}function Ue(e,t){ue.setUint32(he.position+e,de-he.position-e+1);let r=he;he=null,t(r[0]),t(r[1])}re=[Date,Set,Error,RegExp,R,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?function(){}:BigInt64Array,Float32Array,Float64Array,be],te=[{tag:1,encode(e,t){let r=e.getTime()/1e3;(this.useTimestamp32||0===e.getMilliseconds())&&r>=0&&r<4294967296?(fe[de++]=26,ue.setUint32(de,r),de+=4):(fe[de++]=251,ue.setFloat64(de,r),de+=8)}},{tag:258,encode(e,t){t(Array.from(e))}},{tag:27,encode(e,t){t([e.name,e.message])}},{tag:27,encode(e,t){t(["RegExp",e.source,e.flags])}},{getTag:e=>e.tag,encode(e,t){t(e.value)}},{encode(e,t,r){Ie(e,r)}},{getTag(e){if(e.constructor===Uint8Array&&(this.tagUint8Array||ie&&!1!==this.tagUint8Array))return 64},encode(e,t,r){Ie(e,r)}},Ee(68,1),Ee(69,2),Ee(70,4),Ee(71,8),Ee(72,1),Ee(77,2),Ee(78,4),Ee(79,8),Ee(85,4),Ee(86,8),{encode(e,t){let r=e.packedValues||[],n=e.structures||[];if(r.values.length>0){fe[de++]=216,fe[de++]=51,me(4);let e=r.values;t(e),me(0),me(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let t=0,r=e.length;t<r;t++)packedObjectMap[e[t]]=t}if(n){ue.setUint32(de,3655335424),de+=3;let r=n.slice(0);r.unshift(57344),r.push(new R(e.version,1399353956)),t(r)}else t(new R(e.version,1399353956))}}];let Se=new ge({useRecords:!1});const Me=Se.encode,xe=Se.encodeAsIterable,je=Se.encodeAsAsyncIterable,{NEVER:Be,ALWAYS:Ve,DECIMAL_ROUND:Pe,DECIMAL_FIT:_e}=X,Re=512,Fe=1024,Te=2048;e.ALWAYS=Ve,e.DECIMAL_FIT=_e,e.DECIMAL_ROUND=Pe,e.Decoder=k,e.Encoder=ge,e.FLOAT32_OPTIONS=X,e.NEVER=Be,e.REUSE_BUFFER_MODE=Re,e.Tag=R,e.addExtension=function(e){if(e.Class){if(!e.encode)throw new Error("Extension has no encode function");re.unshift(e.Class),te.unshift(e)}!function(e){b[e.tag]=e.decode}(e)},e.clearSource=Y,e.decode=G,e.decodeIter=function(e,t={}){if(!e||"object"!=typeof e)throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const r=new k(t);let n;const i=e=>{let t;n&&(e=Buffer.concat([n,e]),n=void 0);try{t=r.decodeMultiple(e)}catch(r){if(!r.incomplete)throw r;n=e.slice(r.lastPosition),t=r.values}return t};return"function"==typeof e[Symbol.iterator]?function*(){for(const t of e)yield*i(t)}():"function"==typeof e[Symbol.asyncIterator]?async function*(){for await(const t of e)yield*i(t)}():void 0},e.decodeMultiple=Q,e.encode=Me,e.encodeAsAsyncIterable=je,e.encodeAsIterable=xe,e.encodeIter=function(e,t={}){if(e&&"object"==typeof e){if("function"==typeof e[Symbol.iterator])return function*(e,t){const r=new ge(t);for(const t of e)yield r.encode(t)}(e,t);if("function"==typeof e.then||"function"==typeof e[Symbol.asyncIterator])return async function*(e,t){const r=new ge(t);for await(const t of e)yield r.encode(t)}(e,t);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable")},e.isNativeAccelerationEnabled=!1,e.roundFloat32=function(e){P[0]=e;let t=q[(127&_[3])<<1|_[2]>>7];return(t*e+(e>0?.5:-.5)>>0)/t},e.setSizeLimits=function(e){e.maxMapSize&&(y=e.maxMapSize),e.maxArraySize&&(h=e.maxArraySize),e.maxObjectSize&&e.maxObjectSize}}));
(function(){function a(a=100){let b=Date.now();const c=new MessageChannel,d=[];return c.port1.onmessage=()=>{const a=d.shift();a&&a()},function(e=!1){const f=Date.now();return e||f-b>a?(b=f,(async()=>{"scheduler"in window&&"yield"in scheduler?await scheduler.yield():await new Promise(a=>{d.push(a),c.port2.postMessage(null)})})()):null}}async function b(a,b){const c=await crypto.subtle.importKey("raw",j.encode(a),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:b,iterations:6e5,hash:"SHA-256"},c,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}function c(a,b,c){return!c.exclude?.[a]?.some(a=>b===a||b.startsWith(a+"/"))&&(!(0<c.include?.[a]?.length)||c.include[a].some(a=>b===a||b.startsWith(a+"/")))}function d(a,b){if(!a||"object"!=typeof a)return a;if(a instanceof Blob){const c=(g++).toString(36);return b.push({uuid:c,blob:a}),{__le_blob_ref:c,type:a.type,size:a.size}}if(a instanceof ArrayBuffer||ArrayBuffer.isView(a)||a instanceof Date||a instanceof RegExp)return a;if(Array.isArray(a)){const c=a.length,e=Array(c);for(let f=0;f<c;f++)e[f]=d(a[f],b);return e}const c={};for(const e in a)c[e]=d(a[e],b);return c}async function e(a,b){if(!a||"object"!=typeof a)return a;if(a.__le_blob_ref){const c=await b.getFileHandle(a.__le_blob_ref),d=await c.getFile();return d.slice(0,d.size,a.type)}if(a.__le_blob)return new Blob([a.data],{type:a.type});if(Array.isArray(a))return Promise.all(a.map(a=>e(a,b)));if(a.constructor===Object){const c={};for(const d in a)c[d]=await e(a[d],b);return c}return a}function f(a,b,c,d=!1){if(8589934591<b)throw new Error("File size exceeds USTAR 8GB limit. Extensions required.");const e=n.slice(0);d&&(!a.endsWith("/")&&(a+="/"),e[156]=53);const f=j.encode(a);if(100>=f.length)e.set(f,0);else{let b=-1;for(let a=0;a<f.length;a++)if(47===f[a]){const c=a,d=f.length-1-a;155>=c&&100>=d&&0<d&&(b=a)}if(-1!=b)e.set(f.subarray(b+1),0),e.set(f.subarray(0,b),345);else throw new Error(`Filename too long or unsplittable for USTAR: ${a}`)}const g=(a,b,c)=>{const d=Math.floor(a).toString(8).padStart(c-1,"0");if(d.length>=c)throw new Error("Octal field overflow");j.encodeInto(d,e.subarray(b,b+c-1)),e[b+c-1]=0};g(b,124,12),g(c,136,12);let h=0;for(let f=0;512>f;f++)h+=e[f];const i=h.toString(8).padStart(6,"0");return j.encodeInto(i,e.subarray(148)),e[154]=0,e[155]=32,e}let g=0;const h=4194304,i=65536,j=new TextEncoder,k=new TextDecoder,l=".rfs_temp_blobs",m={USTAR_MAGIC:new Uint8Array([117,115,116,97,114,0]),USTAR_VER:new Uint8Array([48,48]),EMPTY_SPACE:new Uint8Array(8).fill(32)},n=new Uint8Array(512);(function(){const a=(a,b)=>j.encodeInto(a,n.subarray(b));a("000664 \0",100),a("000000 \0",108),a("000000 \0",116),n.set(m.EMPTY_SPACE,148),n[156]=48,n.set(m.USTAR_MAGIC,257),n.set(m.USTAR_VER,263)})();class o{constructor(a,b){this.writer=a.getWriter(),this.yielder=b,this.pos=0,this.bytesWritten=0,this.time=Math.floor(Date.now()/1e3),this.buffer=new Uint8Array(i),this.bufferOffset=0}async writeEntry(a,b){const c="string"==typeof b?j.encode(b):b,d=f(a,c.length,this.time);await this.write(d),await this.write(c),await this.pad()}async writeStream(a,b,c){await this.write(f(a,b,this.time));const d=c.getReader();try{for(;;){const{done:a,value:b}=await d.read();if(a)break;await this.write(b);const c=this.yielder();c&&(await c)}}finally{d.releaseLock()}await this.pad()}async write(a){const b=a.byteLength;b>=i?(await this.flush(),await this.writer.write(a)):this.bufferOffset+b>i?(await this.flush(),this.buffer.set(a,0),this.bufferOffset=b):(this.buffer.set(a,this.bufferOffset),this.bufferOffset+=b),this.pos+=b,this.bytesWritten+=b}async pad(){const a=(512-this.pos%512)%512;if(0<a){const b=new Uint8Array(a);await this.write(b)}}async flush(){0<this.bufferOffset&&(await this.writer.write(this.buffer.subarray(0,this.bufferOffset)),this.bufferOffset=0)}async close(){await this.write(new Uint8Array(1024)),await this.flush(),await this.writer.close()}}class p{constructor(a,c){this.salt=c,this.keyPromise=b(a,c),this.chunks=[],this.currentSize=0}async start(a){a.enqueue(j.encode("LE_ENC")),a.enqueue(this.salt),await this.encryptAndPush(new Uint8Array(0),a,await this.keyPromise)}async transform(a,b){if(this.chunks.push(a),this.currentSize+=a.byteLength,this.currentSize>=h){const a=new Uint8Array(this.currentSize);let d=0;for(const b of this.chunks)a.set(b,d),d+=b.byteLength;const e=await this.keyPromise;let f=0;for(;f+h<=a.length;)await this.encryptAndPush(a.subarray(f,f+h),b,e),f+=h;const g=a.subarray(f);this.chunks=0<g.length?[g]:[],this.currentSize=g.length}}async flush(a){if(0<this.currentSize){const b=new Uint8Array(this.currentSize);let d=0;for(const a of this.chunks)b.set(a,d),d+=a.byteLength;await this.encryptAndPush(b,a,await this.keyPromise)}}async encryptAndPush(a,b,c){const d=crypto.getRandomValues(new Uint8Array(12)),e=await crypto.subtle.encrypt({name:"AES-GCM",iv:d},c,a),f=new DataView(new ArrayBuffer(4));f.setUint32(0,e.byteLength,!0),b.enqueue(d),b.enqueue(new Uint8Array(f.buffer)),b.enqueue(new Uint8Array(e))}}class q{constructor(){this.chunks=[],this.totalSize=0}push(a){a&&0!==a.byteLength&&(this.chunks.push(a),this.totalSize+=a.byteLength)}has(a){return this.totalSize>=a}read(a){if(0===a)return new Uint8Array(0);if(this.totalSize<a)throw new Error("Insufficient data in buffer");if(this.chunks[0].byteLength>=a){const b=this.chunks[0].subarray(0,a);return this.chunks[0].byteLength===a?this.chunks.shift():this.chunks[0]=this.chunks[0].subarray(a),this.totalSize-=a,b}const b=new Uint8Array(a);for(let c=0;c<a;){const d=this.chunks[0],e=a-c,f=Math.min(d.byteLength,e);b.set(d.subarray(0,f),c),c+=f,this.totalSize-=f,f===d.byteLength?this.chunks.shift():this.chunks[0]=d.subarray(f)}return b}}class r{constructor(a,b,c){this.stream=a,this.password=b,this.yielder=c,this.buffer=new q}readable(){async function a(a){for(;!this.buffer.has(a);){const{value:a,done:b}=await c.read();if(b)return!1;this.buffer.push(a)}return!0}let c;return new ReadableStream({async start(d){c=this.stream.getReader();try{if(!(await a(22)))throw new Error("File too small");const e=new TextDecoder().decode(this.buffer.read(6));if("LE_ENC"!==e)throw new Error("Not an encrypted archive");const f=this.buffer.read(16),g=await b(this.password,f);if(!(await a(16)))throw new Error("Corrupt header");const h=this.buffer.read(12),i=this.buffer.read(4),j=new DataView(i.buffer,i.byteOffset,i.byteLength).getUint32(0,!0);if(!(await a(j)))throw new Error("Corrupt header");const k=this.buffer.read(j);try{await crypto.subtle.decrypt({name:"AES-GCM",iv:h},g,k)}catch(a){throw new Error("Incorrect password or corrupt file.")}for(;;){const a=this.yielder();if(a&&(await a),!this.buffer.has(16)){const{value:a,done:b}=await c.read();if(b){if(0===this.buffer.totalSize)break;throw new Error("Truncated encrypted stream")}this.buffer.push(a);continue}const b=this.buffer.read(12),e=this.buffer.read(4),f=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0,!0);for(;!this.buffer.has(f);){const{value:a,done:b}=await c.read();if(b)throw new Error("Unexpected EOF in ciphertext");this.buffer.push(a);const d=this.yielder();d&&(await d)}const h=this.buffer.read(f),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:b},g,h);d.enqueue(new Uint8Array(i))}d.close()}catch(a){d.error(a)}finally{c.releaseLock()}}})}}window.LittleExport={importData:async function(b,c={}){const f=window.CBOR;let g=c,h=b;b&&"object"==typeof b&&!b.stream&&!b.arrayBuffer&&!b.slice&&(b.source||b.include||b.exclude)&&(g=b,h=g.source);const i={...g},j=i.logger||console.log,m=a(i.logSpeed||100);try{async function a(a){for(;!w.has(a)&&!x;){const{value:a,done:b}=await v.read();b?x=!0:(y+=a.byteLength,w.push(a))}return w.has(a)}async function b(b){for(;0<b&&(0!==w.totalSize||x||(await a(1)),0!==w.totalSize);){const a=w.totalSize,c=Math.min(a,b);w.read(c),b-=c}}async function c(a,b){for(let c=b;0<c;){const b=m();if(b&&(await b),0<w.totalSize){const b=w.read(Math.min(c,w.totalSize));await a.write(b),c-=b.byteLength}else{const{value:b,done:e}=await v.read();if(e)throw new Error("Unexpected EOF");y+=b.byteLength,b.byteLength<=c?(await a.write(b),c-=b.byteLength):(await a.write(b.subarray(0,c)),w.push(b.subarray(c)),c=0)}}await a.close()}let d;if("string"==typeof h){h.startsWith("http")||(h="https://"+h);const a=await fetch(h);if(!a.ok)throw new Error("Fetching of URL failed.");d=a.body}else if(h&&"function"==typeof h.stream)d=h.stream();else throw new Error("Invalid source.");const g=d.getReader(),n=[];let o=0;for(;8>o;){const{value:a,done:b}=await g.read();if(b)break;n.push(a),o+=a.byteLength}g.releaseLock();const p=new ReadableStream({async start(a){for(const b of n)a.enqueue(b);const b=d.getReader();try{for(;;){const{value:c,done:d}=await b.read();if(d)break;a.enqueue(c)}a.close()}catch(b){a.error(b)}}}),s=new Uint8Array(8);if(0<o){let a=0;for(const b of n){const c=8-a;if(0>=c)break;const d=Math.min(c,b.byteLength);s.set(b.subarray(0,d),a),a+=d}}const t=k.decode(s.slice(0,6));let u;if("LE_ENC"===t){let a=i.password||prompt("Enter the password:");if(!a)throw new Error("A password is required to decrypt this data.");u=new r(p,a,m).readable().pipeThrough(new DecompressionStream("gzip"))}else u=31===s[0]&&139===s[1]?p.pipeThrough(new DecompressionStream("gzip")):p;const v=u.getReader(),w=new q;let x=!1,y=0;const z=await navigator.storage.getDirectory();let A;try{A=await z.getDirectoryHandle(l,{create:!0})}catch(a){}const B={};for(;!!(await a(512));){const d=w.read(512);if(d.every(a=>0===a))break;let g=k.decode(d.slice(0,100)).replace(/\0/g,"").trim();const h=k.decode(d.slice(345,500)).replace(/\0/g,"").trim();h&&(g=`${h}/${g}`);const l=m();l&&(j(`Importing (${(y/1048576).toFixed(2)} MB) ${g}...`),await l);const n=k.decode(d.slice(124,136)).replace(/\0/g,"").trim(),o=parseInt(n,8),p=(512-o%512)%512;if(g.startsWith("data/")){if(g.startsWith("data/blobs/")){const a=g.split("/").pop();if(A){const b=await A.getFileHandle(a,{create:!0});await c(await b.createWritable(),o)}else await b(o)}else{if(0===o){await b(p);continue}if(!(await a(o)))throw new Error("Unexpected EOF for metadata");const h=w.read(o);if("data/ls.json"===g)Object.assign(localStorage,JSON.parse(k.decode(h)));else if("data/ss.json"===g){const a=JSON.parse(k.decode(h));for(const b in a)sessionStorage.setItem(b,a[b])}else if("data/cookies.json"===g){const a=JSON.parse(k.decode(h));for(const b in a)document.cookie=`${b}=${a[b]}; path=/; max-age=31536000`}else if(g.startsWith("data/custom/")&&i.onCustomItem)await i.onCustomItem(g.replace("data/custom/",""),h);else if(g.startsWith("data/idb/")&&f&&!1!==i.idb){const a=g.split("/"),b=decodeURIComponent(a[2]);if(g.endsWith("schema.cbor")){const a=f.decode(h);B[b]&&(B[b].close(),delete B[b]),await new Promise(b=>{const c=indexedDB.deleteDatabase(a.name);c.onsuccess=b,c.onerror=b}),await new Promise((b,c)=>{const d=indexedDB.open(a.name,a.version);d.onupgradeneeded=b=>{const c=b.target.result;a.stores.forEach(a=>{if(!c.objectStoreNames.contains(a.name)){const b=c.createObjectStore(a.name,{keyPath:a.keyPath,autoIncrement:a.autoIncrement});a.indexes.forEach(a=>b.createIndex(a.name,a.keyPath,{unique:a.unique,multiEntry:a.multiEntry}))}})},d.onsuccess=a=>{a.target.result.close(),b()},d.onerror=c})}else{const c=decodeURIComponent(a[3]),d=await e(f.decode(h),A);B[b]||(B[b]=await new Promise((a,c)=>{const d=indexedDB.open(b);d.onsuccess=()=>a(d.result),d.onerror=c}));try{const a=B[b].transaction(c,"readwrite"),e=a.objectStore(c);await Promise.all(d.map(a=>new Promise(b=>{const c=e.put(a.v,e.keyPath?void 0:a.k);c.onsuccess=b,c.onerror=b})))}catch(a){console.error(a),alert("IDB importing error for DB "+b+"(perhaps close other tabs?): "+a)}}}}}else if(!1!==i.opfs){const a=g.startsWith("opfs/")?g.replace("opfs/",""):g,d=a.split("/").filter(a=>a.length);if(0<d.length){const a=d.pop();let b=z;for(const a of d)b=await b.getDirectoryHandle(a,{create:!0});const e=await b.getFileHandle(a,{create:!0});if(0<o)await c(await e.createWritable(),o);else{const a=await e.createWritable();await a.close()}}else await b(o)}else await b(o);await b(p)}if(Object.values(B).forEach(a=>a.close()),A)try{await z.removeEntry(l,{recursive:!0})}catch(a){}j("Import complete!"),i.onsuccess&&i.onsuccess()}catch(a){if(j("Error: "+a.message),i.onerror)i.onerror(a);else throw a}},exportData:async function(b={}){g=0;const e=window.CBOR,f={fileName:"archive",opfs:!0,localStorage:!0,session:!0,cookies:!0,idb:!0,cache:!0,logSpeed:100,customItems:[],include:{},exclude:{},dbFilter:()=>!0,...b},h=f.logger||console.log,i=a(f.logSpeed);let j,k,l=[];if(window.showSaveFilePicker&&!1!==f.download)try{const a=f.password?`${f.fileName}.enc`:`${f.fileName}.tar.gz`,b=await window.showSaveFilePicker({suggestedName:a});j=await b.createWritable()}catch(a){if("AbortError"===a.name)return void h("Export cancelled.");console.warn("FileSystem picker failed, falling back.")}j||(j=new WritableStream({write(a){l.push(a)}}));let m=0;const n=new TransformStream({transform(a,b){m+=a.byteLength,b.enqueue(a)}}),q=new CompressionStream("gzip");let r=q.readable;if(f.password){h("Encrypting...");const a=crypto.getRandomValues(new Uint8Array(16));r=r.pipeThrough(new TransformStream(new p(f.password,a)))}const s=r.pipeThrough(n).pipeTo(j),t=new o(q.writable,i);try{for(const a of f.customItems){h(`Archiving custom: ${a.path}`);const b=`data/custom/${a.path}`;a.data instanceof Blob?await t.writeStream(b,a.data.size,a.data.stream()):await t.writeEntry(b,"string"==typeof a.data?a.data:JSON.stringify(a.data))}if(f.localStorage){const a={};for(let b=0;b<localStorage.length;b++){const d=localStorage.key(b);c("localStorage",d,f)&&(a[d]=localStorage.getItem(d))}await t.writeEntry("data/ls.json",JSON.stringify(a))}if(f.session){const a={};for(let b=0;b<sessionStorage.length;b++){const d=sessionStorage.key(b);c("session",d,f)&&(a[d]=sessionStorage.getItem(d))}await t.writeEntry("data/ss.json",JSON.stringify(a))}if(f.cookies){const a=document.cookie.split(";").reduce((a,b)=>{const[c,d]=b.split("=").map(a=>a.trim());return c&&(a[c]=d),a},{});await t.writeEntry("data/cookies.json",JSON.stringify(a))}if(f.idb&&window.indexedDB&&e){const a=await window.indexedDB.databases();for(const{name:b,version:g}of a){if(!c("idb",b,f)||!f.dbFilter(b))continue;const a=encodeURIComponent(b);h(`Scanning IDB: ${b}`);const j=await new Promise((a,c)=>{const d=indexedDB.open(b);d.onsuccess=()=>a(d.result),d.onerror=()=>c(d.error),d.onblocked=()=>c(new Error("IndexedDB open was blocked."))}),k=Array.from(j.objectStoreNames),l=[];if(0<k.length){const a=j.transaction(k,"readonly");for(const b of k){const c=a.objectStore(b);l.push({name:b,keyPath:c.keyPath,autoIncrement:c.autoIncrement,indexes:Array.from(c.indexNames).map(a=>{const b=c.index(a);return{name:b.name,keyPath:b.keyPath,unique:b.unique,multiEntry:b.multiEntry}})})}}j.close(),await t.writeEntry(`data/idb/${a}/schema.cbor`,e.encode({name:b,version:g,stores:l}));for(const c of k){h(`Archiving IDB: ${b}/${c}`);let f=null,g=0,j=!0;for(;j;){const h=await new Promise((a,d)=>{const e=indexedDB.open(b);e.onsuccess=b=>{const g=b.target.result;try{const b=g.transaction(c,"readonly"),e=b.objectStore(c),h=f?IDBKeyRange.lowerBound(f,!0):null,i=e.openCursor(h),j=[];i.onsuccess=b=>{const c=b.target.result;c&&j.length<200?(j.push({k:c.key,v:c.value}),f=c.key,c.continue()):(g.close(),a({items:j,done:!c}))},i.onerror=a=>{g.close(),d(a)}}catch(a){g.close(),d(a)}},e.onerror=a=>d(a)});if(j=!h.done,0<h.items.length){const b=[];for(const a of h.items){const c=[],e=d(a.v,c);b.push({k:a.k,v:e});for(const a of c)await t.writeStream(`data/blobs/${a.uuid}`,a.blob.size,a.blob.stream())}await t.writeEntry(`data/idb/${a}/${encodeURIComponent(c)}/${g++}.cbor`,e.encode(b));const f=i();f&&(await f)}}}}}if(f.cache&&window.caches&&e)for(const a of await caches.keys()){if(!c("cache",a,f))continue;h(`Archiving Cache: ${a}`);const b=i();b&&(await b);const d=await caches.open(a);for(const b of await d.keys()){const c=await d.match(b);if(!c)continue;const f=await c.blob(),g=btoa(b.url).slice(0,50).replace(/\//g,"_");await t.writeEntry(`data/cache/${encodeURIComponent(a)}/${g}.cbor`,e.encode({meta:{url:b.url,status:c.status,headers:Object.fromEntries(c.headers),type:f.type},data:new Uint8Array(await f.arrayBuffer())}))}}if(f.opfs&&navigator.storage){async function a(b,d){for await(const e of b.values()){const b=i();b&&(await b);const g=d?`${d}/${e.name}`:e.name;if(c("opfs",g,f))if("file"===e.kind){const a=await e.getFile();await t.writeStream(`opfs/${g}`,a.size,a.stream())}else await a(e,g)}}const b=await navigator.storage.getDirectory();await a(b,"")}if(await t.close(),await s,0<l.length&&(k=URL.createObjectURL(new Blob(l,{type:"application/octet-stream"}))),k){const b=document.createElement("a");b.href=k,b.download=f.password?`${f.fileName}.enc`:`${f.fileName}.tar.gz`,b.click(),setTimeout(()=>URL.revokeObjectURL(k),1e3)}reportProgress(),h("Export complete!")}catch(a){h("Export error: "+a.message),console.error(a);try{await targetWritable.abort(a)}catch(a){}}},deriveKey:b}})();
const SW_LINK="./sw.min.js",RFS_PREFIX="rfs",SYSTEM_FILE="rfs_system.json",CHUNK_SIZE=4194304,CONCURRENCY=4,YIELD_TIME=50;let folderName,dirHandle,observer,isListingFolders=!1,currentlyBusy=!1,changes=[],showingSync=!1,_registryCache=null,_opfsRoot=null;async function getOpfsRoot(){return _opfsRoot||(_opfsRoot=await navigator.storage.getDirectory()),_opfsRoot}function setUiBusy(a){currentlyBusy!==a&&(currentlyBusy=a,Array.from(document.getElementsByTagName("button")).forEach(a=>a.disabled=currentlyBusy))}function createLogger(a,b){let c=null;return function(d,e=!1){return d!==c&&null!==d&&(a.textContent=c=d),b(e)}}const checkYield=function(){let a=Date.now();const b=new MessageChannel;let c=null;b.port1.onmessage=()=>{c&&c()};const d=()=>new Promise(a=>{c=a,b.port2.postMessage(null)});return function(b=!1){return b||Date.now()-a>YIELD_TIME?(a=Date.now(),(async()=>{"scheduler"in window&&"yield"in scheduler?await scheduler.yield():await d()})()):null}}(),logProgress=createLogger(document.getElementById("progress"),checkYield);window.addEventListener("beforeunload",function(){if(currentlyBusy)return"Changes you made may not be saved."}),navigator.storage.persist().then(a=>console.log(a?"Storage persisted.":"Storage not persisted."));async function waitForController(){if(navigator.serviceWorker.controller)return navigator.serviceWorker.controller;await navigator.serviceWorker.register(SW_LINK);const a=await navigator.serviceWorker.ready;return navigator.serviceWorker.controller||a.active}async function getRegistry(){return _registryCache?_registryCache:await navigator.locks.request("rfs_registry_lock",{mode:"shared"},async()=>{if(_registryCache)return _registryCache;try{const a=await getOpfsRoot(),b=await a.getFileHandle(SYSTEM_FILE),c=await b.getFile(),d=await c.text();_registryCache=d?JSON.parse(d):{}}catch(a){_registryCache={}}return _registryCache})}async function saveRegistry(a){_registryCache=a,await navigator.locks.request("rfs_registry_lock",{mode:"exclusive"},async()=>{const b=await getOpfsRoot(),c=await b.getFileHandle(SYSTEM_FILE,{create:!0}),d=await c.createWritable();await d.write(JSON.stringify(a)),await d.close()})}let _registryWriteQueue=Promise.resolve();async function updateRegistryEntry(a,b){return navigator.locks.request("rfs_registry_lock",{mode:"exclusive"},async()=>{const c=await getOpfsRoot();let d={};try{const a=await c.getFileHandle(SYSTEM_FILE),b=await a.getFile();d=JSON.parse(await b.text())}catch(a){d={}}null===b?delete d[a]:d[a]={...(d[a]||{}),...b,lastModified:Date.now()},_registryCache=d;const e=await c.getFileHandle(SYSTEM_FILE,{create:!0}),f=await e.createWritable();await f.write(JSON.stringify(d)),await f.close(),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"INVALIDATE_CACHE",folderName:a})})}async function uploadFolder(){const a=document.getElementById("folderName"),b=a.value.trim();if(!b)return alert("Please enter a name.");try{if(window.showDirectoryPicker){const a=await window.showDirectoryPicker({mode:"read"});setUiBusy(!0),await processFolderSelection(b,a)}else document.getElementById("folderUploadFallbackInput").click()}catch(a){if("AbortError"!==a.name)throw a}}async function processFolderSelection(a,b){dirHandle=b,folderName=a;try{const c=await b.getFileHandle("manifest.enc"),d=await getOpfsRoot(),e=await d.getDirectoryHandle(RFS_PREFIX,{create:!0});try{await e.removeEntry(a,{recursive:!0})}catch(a){return void("NotFoundError"!==a.name&&alert("RuntimeFS cannot currently remove this folder; try closing other open RuntimeFS tabs."))}await decryptAndLoadFolderToOpfs(b,c,await e.getDirectoryHandle(a,{create:!0})),await updateRegistryEntry(a,{encryptionType:null})}catch(c){await processAndStoreFolderStreaming(a,b)}if(observer){try{observer.disconnect()}catch(a){}observer=null}if("FileSystemObserver"in window)try{observer=new FileSystemObserver(a=>changes.push(...a)),observer.observe(dirHandle,{recursive:!0}),showingSync||(Array.from(document.body.getElementsByClassName("supportCheck")).forEach(a=>a.style.display="revert"),showingSync=!0)}catch(a){console.warn("Observer failed:",a)}changes.length=0,document.getElementById("folderName").value="",document.getElementById("openFolderName").value=a,setUiBusy(!1),await listFolders()}async function decryptAndLoadFolderToOpfs(a,b,c){const d=prompt("Enter the password to decrypt this folder:");if(!d)throw new Error("Password required.");const e=await b.getFile(),f=await e.arrayBuffer(),g=f.slice(0,16),h=f.slice(16,28),i=f.slice(28),j=await deriveKeyFromPassword(d,g);let k;try{const a=await crypto.subtle.decrypt({name:"AES-GCM",iv:h},j,i);k=JSON.parse(new TextDecoder().decode(a))}catch(a){throw new Error("Decryption failed. Wrong password?")}const l=await a.getDirectoryHandle("content"),m=Object.entries(k);let n=0;const o=m.length;for(const[d,e]of m){const a=logProgress(`Decrypting (${n}/${o}): ${d}`);a&&(await a);const b=d.split("/"),f=b.pop();let g=c;for(const a of b)g=await g.getDirectoryHandle(a,{create:!0});let h;try{const a=await l.getFileHandle(e.id);h=await a.getFile()}catch(a){console.warn(`Missing: ${d}`);continue}const i=await g.getFileHandle(f,{create:!0}),k=await i.createWritable();if(0<e.size){const a=h.stream().getReader(),b=Math.ceil(e.size/CHUNK_SIZE);let c=new Uint8Array(0),f=0;try{for(;f<b;){const g=checkYield();g&&(await g);const h=f===b-1,i=h?e.size%CHUNK_SIZE||CHUNK_SIZE:CHUNK_SIZE,l=i+28,m=[];let n=c.length;for(;n<l;){const{done:b,value:c}=await a.read();if(b)break;m.push(c),n+=c.length}if(0<m.length){const a=new Uint8Array(n);a.set(c);let b=c.length;for(const c of m)a.set(c,b),b+=c.length;c=a}if(c.length<l)break;const o=c.slice(0,l);c=c.slice(l);const p=o.slice(0,12),q=o.slice(12);try{const a=await crypto.subtle.decrypt({name:"AES-GCM",iv:p},j,q);await k.write(new Uint8Array(a))}catch(a){console.error(`Decryption error at chunk ${f} for ${d}`)}f++}}finally{a.releaseLock()}}try{await k.close()}catch(a){if("TypeError"!==a.name)throw a}n++}await logProgress("",!0)}async function processFileListAndStore(a,b){const c=await getOpfsRoot(),d=await c.getDirectoryHandle(RFS_PREFIX,{create:!0});try{await d.removeEntry(a,{recursive:!0})}catch(a){}const e=await d.getDirectoryHandle(a,{create:!0}),f=Array.from(b),g=f.reduce((a,b)=>a+b.size,0),h=(g/1048576).toFixed(2);let i=0,j=0,k="";f[0]?.webkitRelativePath?.includes("/")&&(k=f[0].webkitRelativePath.split("/")[0]+"/");const l=()=>{if(524288>i-j&&i!==g)return null;j=i;const a=(i/1048576).toFixed(2),b=0<g?100*(i/g):0;return logProgress(`Uploading: ${b.toFixed(2)}% (${a}/${h} MB)`)},m=async()=>{for(const a=new Map;0<f.length;){const b=f.shift();if(!b)break;let c=b.webkitRelativePath||b.name;k&&c.startsWith(k)&&(c=c.substring(k.length)),await writeStreamToOpfs(e,c,b,{dirCache:a,onProgress:a=>(i+=a,l())})}};await Promise.all(Array(CONCURRENCY).fill(null).map(m)),document.getElementById("folderName").value="",document.getElementById("openFolderName").value=a,await updateRegistryEntry(a,{encryptionType:null}),await logProgress("",!0),await listFolders()}async function processAndStoreFolderStreaming(a,b){const c=await getOpfsRoot(),d=await c.getDirectoryHandle(RFS_PREFIX,{create:!0});try{await d.removeEntry(a,{recursive:!0})}catch(a){"NotFoundError"!==a.name&&alert("RuntimeFS cannot currently remove this folder; try closing other open RuntimeFS tabs.")}const e=await d.getDirectoryHandle(a,{create:!0}),f=[];let g=!1,h=0,i=0,j=0;const k=()=>{const a=(j/1048576).toFixed(1),b=(i/1048576).toFixed(1);let c="";if(!g)c=`Processing: ${h} files found (${b} MB scanned)...`;else{const d=0<i?100*(j/i):0;c=`Uploading: ${d.toFixed(1)}% (${a}/${b} MB)`}logProgress(c)},l=async()=>{for(const a=new Map;;){if(0<f.length){const b=f.shift(),c=await b.entry.getFile();i+=c.size,await writeStreamToOpfs(b.dest,b.entry.name,c,{dirCache:a,onProgress:a=>{j+=a,k()}})}else{if(g)break;await new Promise(a=>setTimeout(a,20))}await checkYield()}},m=Array(CONCURRENCY).fill(null).map(l),n=[{source:b,dest:e}];for(;0<n.length;){const{source:a,dest:b}=n.shift(),c=a.values();for(;;){const{value:a,done:d}=await c.next();if(d)break;if("file"===a.kind)for(h++,f.push({dest:b,entry:a}),0==h%100&&k();1e3<f.length;)await new Promise(a=>setTimeout(a,20));else{const c=await b.getDirectoryHandle(a.name,{create:!0});n.push({source:a,dest:c})}await checkYield()}}g=!0,await Promise.all(m),document.getElementById("folderName").value="",document.getElementById("openFolderName").value=a,await updateRegistryEntry(a,{encryptionType:null}),await logProgress("",!0),await listFolders(),setUiBusy(!1)}async function writeStreamToOpfs(a,b,c,d={}){const{dirCache:e=null,onProgress:f=null}=d,g=b.split("/"),h=g.pop();let i=a;if(0<g.length){let a="";for(const b of g)a+=(a?"/":"")+b,e&&e.has(a)?i=e.get(a):(i=await i.getDirectoryHandle(b,{create:!0}),e&&e.set(a,i))}const j=await i.getFileHandle(h,{create:!0}),k=await j.createWritable();try{if(!f)await k.write(c);else{const a=new TransformStream({async transform(a,b){b.enqueue(a);const c=f(a.byteLength);c&&(await c)}});await c.stream().pipeThrough(a).pipeTo(k,{preventClose:!0})}}finally{await k.close()}}async function listFolders(){if(!isListingFolders){isListingFolders=!0;const a=document.getElementById("folderList");try{const b=await getRegistry();a.textContent="";const c=document.createDocumentFragment(),d=Object.keys(b).sort();d.forEach(a=>{const d=b[a],e=document.createElement("li");e.textContent="password"===d.encryptionType?`[Locked] ${a}`:a,c.appendChild(e)}),a.appendChild(c)}finally{isListingFolders=!1}}}async function deleteFolder(a,b=!1){const c=a||document.getElementById("deleteFolderName").value.trim();if(!c)return alert("Enter a folder name first.");if(b||confirm(`Remove "${c}"?`)){setUiBusy(!0),logProgress("Deleting...",!0);const d=await getOpfsRoot();try{const a=await d.getDirectoryHandle(RFS_PREFIX);await a.removeEntry(c,{recursive:!0})}catch(a){if("NotFoundError"!==a.name)return void alert("RuntimeFS cannot currently remove this folder; try closing other open RuntimeFS tabs.")}await updateRegistryEntry(c,null),a||(document.getElementById("deleteFolderName").value=""),await listFolders(),logProgress("",!0),b||setUiBusy(!1)}}async function openFile(a){const b=a||document.getElementById("openFolderName").value.trim(),c=document.getElementById("fileName").value.trim();if(!b)return alert("Provide a folder name.");setUiBusy(!0);const d=await getRegistry(),e=d[b];if(!e)return alert("Folder not found.");const f=document.getElementById("regex").value.trim(),g=document.getElementById("headers").value.trim();(e.rules!==f||e.headers!==g)&&(await updateRegistryEntry(b,{rules:f,headers:g}));let h=null;if("password"===e.encryptionType){const a=prompt(`Enter password for "${b}":`);if(!a)return setUiBusy(!1);h=await deriveKeyFromPassword(a,base64ToBuffer(e.salt))}const i=await waitForController();await new Promise(a=>{const c=new MessageChannel;c.port1.onmessage=()=>a(),i.postMessage({type:"SET_RULES",rules:f,headers:g,key:h,folderName:b},[c.port2])});const j=c.split("/").map(encodeURIComponent).join("/");window.open(`n/${encodeURIComponent(b)}/${j}`,"_blank"),setUiBusy(!1)}async function startImport(a){setUiBusy(!0);const b=await navigator.storage.getDirectory();try{await b.removeEntry(RFS_PREFIX,{recursive:!0})}catch(a){}try{await b.removeEntry(SYSTEM_FILE)}catch(a){}try{await b.removeEntry(".rfs_temp_blobs",{recursive:!0})}catch(a){}await LittleExport.importData(a,{logger:logProgress,onCustomItem:async(a,b)=>{if(a===SYSTEM_FILE){const a=new TextDecoder,c=JSON.parse(a.decode(b));await saveRegistry(c)}}}),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"INVALIDATE_CACHE"}),await listFolders(),alert("Import complete!"),setUiBusy(!1),logProgress("",!0)}async function exportData(){setUiBusy(!0);let a=prompt("Enter a password (or leave blank for no encryption):");const b=await getRegistry();await LittleExport.exportData({fileName:"result",password:a,cookies:document.getElementById("c1").checked,localStorage:document.getElementById("c2").checked,idb:document.getElementById("c3").checked,opfs:document.getElementById("c5").checked,cache:document.getElementById("c6").checked,session:document.getElementById("c7").checked,customItems:[{path:SYSTEM_FILE,data:JSON.stringify(b)}],exclude:{opfs:[SYSTEM_FILE]},logger:logProgress}),setUiBusy(!1),logProgress("",!0)}async function importData(){const a=document.createElement("input");a.type="file",a.onchange=a=>{a.target.files[0]&&startImport(a.target.files[0])},a.click()}function base64ToBuffer(a){const b=atob(a),c=b.length,d=new Uint8Array(c);for(let e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer}function bufferToBase64(a){let b="";const c=new Uint8Array(a),d=c.byteLength;for(let e=0;e<d;e++)b+=String.fromCharCode(c[e]);return btoa(b)}async function deriveKeyFromPassword(a,b){const c=new TextEncoder,d=await crypto.subtle.importKey("raw",c.encode(a),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:b,iterations:6e5,hash:"SHA-256"},d,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function uploadFolderFallback(a){const b=document.getElementById("folderName").value.trim();if(!b)return alert("Please enter a name.");const c=a.target;return c.files.length?void(setUiBusy(!0),await processFileListAndStore(b,c.files),c.value="",setUiBusy(!1)):void setUiBusy(!1)}let syncTimeout=-1;async function syncFiles(){return folderName&&dirHandle?void(setUiBusy(!0),0<changes.length?(await performSyncToOpfs(),document.getElementById("syncInfo").textContent="Sync complete."):document.getElementById("syncInfo").textContent="No changes to sync.",clearTimeout(syncTimeout),syncTimeout=setTimeout(()=>document.getElementById("syncInfo").textContent="",1e3),setUiBusy(!1)):alert("It seems that syncing isn't supported for your browser.")}async function syncAndOpenFile(){return folderName&&dirHandle?void(setUiBusy(!0),0<changes.length?(await performSyncToOpfs(),document.getElementById("syncInfo").textContent="Sync complete."):document.getElementById("syncInfo").textContent="No changes to sync.",clearTimeout(syncTimeout),syncTimeout=setTimeout(()=>document.getElementById("syncInfo").textContent="",1e3),openFile(folderName)):alert("It seems that syncing isn't supported for your browser.")}async function performSyncToOpfs(){console.log(`Syncing ${changes.length} changes...`),await navigator.locks.request(`lock_rfs_${folderName}`,async()=>{const a=await getOpfsRoot(),b=await a.getDirectoryHandle(RFS_PREFIX),c=await b.getDirectoryHandle(folderName),d=changes.slice(0);changes.length=0;for(const a of d){const b=a.relativePathComponents;if(!b)continue;const d=b.join("/");try{if("deleted"===a.type){let a=c;const d=b.slice(0,-1),e=b[b.length-1];for(const b of d)a=await a.getDirectoryHandle(b);await a.removeEntry(e,{recursive:!0})}else{let a=dirHandle;for(let c=0;c<b.length-1;c++)a=await a.getDirectoryHandle(b[c]);const e=await a.getFileHandle(b[b.length-1]),g=await e.getFile();await writeStreamToOpfs(c,d,g,{totalSize:g.size})}}catch(a){console.warn(`Sync failed for ${d}:`,a)}}})}async function uploadAndEncryptWithPassword(){const a=document.getElementById("encryptFolderName").value.trim(),b=prompt("Password:");if(!a||!b)return;setUiBusy(!0);const c=await window.showDirectoryPicker({mode:"read"}),d=await getOpfsRoot(),e=await d.getDirectoryHandle(RFS_PREFIX,{create:!0});try{await e.removeEntry(a,{recursive:!0})}catch(a){if("NotFoundError"!==a.name)return void alert("RuntimeFS cannot currently remove this folder; try closing other open RuntimeFS tabs.")}const f=await e.getDirectoryHandle(a,{create:!0}),g=await f.getDirectoryHandle("content",{create:!0}),h=crypto.getRandomValues(new Uint8Array(16)),i=await deriveKeyFromPassword(b,h),j={},k=[],l=[{dir:c,path:""}];let m=!0;const n=async()=>{for(;;){if(0===k.length){if(!m)break;const a=checkYield();a&&(await a);continue}const a=k.shift(),{entry:b,entryPath:c,fileId:d}=a,e=logProgress(`Encrypting: ${a.entryPath}`);e&&(await e);const f=await b.getFile();j[c]={id:d,size:f.size,type:f.type};const h=await g.getFileHandle(d,{create:!0}),l=await h.createWritable();if(0<f.size){const a=f.stream().getReader();let b=[],c=0;try{for(;;){const{done:d,value:e}=await a.read();if(e&&(b.push(e),c+=e.byteLength),(d||c>=CHUNK_SIZE)&&0<c){const a=new Uint8Array(c);let e=0;for(const d of b)a.set(d,e),e+=d.byteLength;let f=0;for(;f<c;){const e=c-f;if(!d&&e<CHUNK_SIZE){const d=a.slice(f);b=[d],c=d.byteLength;break}const g=checkYield();g&&(await g);const h=Math.min(CHUNK_SIZE,e),j=a.subarray(f,f+h),k=crypto.getRandomValues(new Uint8Array(12)),m=await crypto.subtle.encrypt({name:"AES-GCM",iv:k},i,j);await l.write(k),await l.write(new Uint8Array(m)),f+=h}f>=c&&(b=[],c=0)}if(d)break}}finally{a.releaseLock(),await l.close()}}else await l.close()}},o=(async()=>{for(;0<l.length;){const{dir:a,path:b}=l.shift();for await(const c of a.values()){const a=b?`${b}/${c.name}`:c.name;if("file"===c.kind){const b=crypto.randomUUID();for(k.push({entry:c,entryPath:a,fileId:b});500<k.length;)await new Promise(a=>setTimeout(a,20))}else l.push({dir:c,path:a})}}m=!1})(),q=Array(CONCURRENCY).fill(null).map(n);await o,await Promise.all(q);const r=logProgress("Saving manifest...");r&&(await r);const p=JSON.stringify(j),s=new TextEncoder().encode(p),t=crypto.getRandomValues(new Uint8Array(12)),u=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},i,s),v=await f.getFileHandle("manifest.enc",{create:!0}),w=await v.createWritable();await w.write(h),await w.write(t),await w.write(new Uint8Array(u)),await w.close(),await updateRegistryEntry(a,{encryptionType:"password",salt:bufferToBase64(h)}),document.getElementById("encryptFolderName").value="",await listFolders(),setUiBusy(!1),logProgress("",!0)}document.addEventListener("DOMContentLoaded",()=>{if("file:"===window.location.protocol)return void alert("RuntimeFS cannot run from a local file:// context; use an online version or localhost instead.");if(!window.isSecureContext)return void alert("RuntimeFS cannot run in a non-secure context.");if(!("serviceWorker"in navigator))return void alert("RuntimeFS cannot run without ServiceWorkers enabled.");document.getElementById("folderName").addEventListener("keydown",a=>{"Enter"!==a.key||currentlyBusy||uploadFolder()}),document.getElementById("openFolderName").addEventListener("keydown",a=>{"Enter"!==a.key||currentlyBusy||(a.shiftKey?openFileInPlace():a.ctrlKey||a.metaKey?syncAndOpenFile():openFile())}),document.getElementById("fileName").addEventListener("keydown",a=>{"Enter"!==a.key||currentlyBusy||(a.shiftKey?openFileInPlace():a.ctrlKey||a.metaKey?syncAndOpenFile():openFile())}),document.getElementById("deleteFolderName").addEventListener("keydown",a=>{"Enter"!==a.key||currentlyBusy||deleteFolder()}),document.getElementById("folderUploadFallbackInput").addEventListener("change",uploadFolderFallback),window.showSaveFilePicker&&(document.getElementById("encryptionSection").style.display="revert");const a=document.body;a.addEventListener("dragover",b=>{b.preventDefault(),a.style.backgroundColor="#385b7e"}),a.addEventListener("dragleave",()=>{a.style.backgroundColor=""}),a.addEventListener("drop",async b=>{if(b.preventDefault(),a.style.backgroundColor="",!currentlyBusy){const a=Array.from(b.dataTransfer.items);if(a.length){const b=a[0].webkitGetAsEntry?a[0].webkitGetAsEntry():null;if(b&&b.isDirectory){const a=prompt("Please choose a folder name:",b.name);if(a){setUiBusy(!0);const c=[],d=[{entry:b,path:""}];for(let a=0;0<d.length;){const{entry:b,path:e}=d.shift();if(b.isFile){const d=await new Promise((a,c)=>b.file(a,c));Object.defineProperty(d,"webkitRelativePath",{value:e+d.name}),c.push(d),a++}else if(b.isDirectory){const a=b.createReader();let c;do{c=await new Promise((b,c)=>a.readEntries(b,c));for(const a of c)d.push({entry:a,path:e+b.name+"/"})}while(0<c.length)}0==a%50&&(await logProgress(`Scanned ${a} files...`))}await logProgress(`Processed ${c.length} files...`),await processFileListAndStore(a,c),setUiBusy(!1)}return}const c=a[0].getAsFile();1===a.length&&c&&confirm(`Import "${c.name}"?`)&&startImport(c)}}}),navigator.serviceWorker.register(SW_LINK).then(a=>{a.addEventListener("updatefound",()=>{const b=a.installing;b.addEventListener("statechange",()=>{"installed"===b.state&&navigator.serviceWorker.controller&&location.reload()})})}).catch(console.error),navigator.serviceWorker.addEventListener("message",async a=>{a.data&&"SW_READY"===a.data.type&&(await listFolders()),a.data&&"INVALIDATE_CACHE"===a.data.type&&(await listFolders())}),listFolders();const b=document.getElementById("regex"),c=document.getElementById("headers");b.value=localStorage.getItem("fsRegex")||"",b.addEventListener("input",()=>localStorage.setItem("fsRegex",b.value)),c.value=localStorage.getItem("fsHeaders")||"",c.addEventListener("input",()=>localStorage.setItem("fsHeaders",c.value))});async function openFileInPlace(){if(!navigator.serviceWorker.controller)return void alert("Service Worker is not controlling the page. Please reload and try again.");const a=document.getElementById("openFolderName").value.trim(),b=document.getElementById("fileName").value.trim();if(!a)return alert("Provide a folder name.");setUiBusy(!0);const c=await getRegistry(),d=c[a];if(!d)return alert("Folder not found.");const e=document.getElementById("regex").value.trim(),f=document.getElementById("headers").value.trim();(d.rules!==e||d.headers!==f)&&(await updateRegistryEntry(a,{rules:e,headers:f}));let g=null;if("password"===d.encryptionType){const b=prompt(`Enter password for "${a}":`);if(!b)return setUiBusy(!1);g=await deriveKeyFromPassword(b,base64ToBuffer(d.salt))}const h=await waitForController();await Promise.race([new Promise(b=>{const c=new MessageChannel;c.port1.onmessage=()=>b(),h.postMessage({type:"SET_RULES",rules:e,headers:f,key:g,folderName:a},[c.port2])}),new Promise((a,b)=>setTimeout(()=>b(new Error("Service Worker response timed out.")),4e3))]);const i=b?b.split("/").map(encodeURIComponent).join("/"):"index.html",j=`n/${encodeURIComponent(a)}/${i}`,k=await fetch(j,{headers:{Accept:"text/html"}});if(!k.ok){if(403===k.status)return alert("Session authentication failed.");throw new Error(`Failed to load HTML: ${k.status} ${k.statusText}`)}let l=await k.text();const m=j.substring(0,j.lastIndexOf("/")+1),n=`<base href="${m}">`;let o="";k.headers.forEach((a,b)=>{o+=`<meta http-equiv="${b.replace(/"/g,"&quot;")}" content="${a.replace(/"/g,"&quot;")}">\n`}),l=/<head\b[^>]*>/i.test(l)?l.replace(/(<head\b[^>]*>)/i,`$1${n}${o}`):/<html\b[^>]*>/i.test(l)?l.replace(/(<html\b[^>]*>)/i,`$1<head>${n}${o}</head>`):`<head>${n}${o}</head>${l}`,document.open(),document.write(l),document.close(),setUiBusy(!1)}